<!DOCTYPE html>
<html lang="es">
  <head>
    <%= favicon_link_tag asset_path('/images/stvgris.png'), :rel => 'icon', :type =>  'image/png' %>
    <title>
      <%= yield :page_title %>
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <!--<meta name="turbolinks-cache-control" content="no-cache">-->
    <%= csrf_meta_tags %>
    <!--materializecss-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.css">
    <%= stylesheet_link_tag    'application', media: 'all' %>
    <%= javascript_include_tag 'application' %>
    <script src="https://cdn.tiny.cloud/1/no-origin/tinymce/5.10.9-138/langs/es.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Italianno-regular" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
    <%= yield :page_stylesheets %>
  </head>
  <body>
    <% unless user_signed_in? || 
        controller_name == 'sessions' || 
        controller_name == 'registrations' || 
        controller_name == 'passwords' %>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        $('#force-sign-in-modal').modal('show');
      });
    </script>
  <% end %>
  <nav class="navbar fixed-top navbar-expand-lg bg-light shadow bg-white rounded pt-0 pb-0">
    <a class="navbar-brand" href="#">
      <%= image_tag '/images/stvgris.png', width: 60 %>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">STV</a>
        </li>
      </ul>
      <div class="navbar-text d-flex align-items-center p-0">
        <% if user_signed_in? %>
          <!--<%= current_user.email %>-->
          <div class="dropdown mr-3">
            <a class="btn btn-outline-info dropdown-toggle" href="#" role="button" id="current-user-menu-link" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <% if current_user.default_image %>
                <%= image_tag url_for(current_user.avatar), width: 35, class: 'mr-2' %><%= current_user.name %>
              <% else %>
                <i class="fas fa-user-circle fa-2x user-avatar mr-1"></i><%= current_user.name %>
              <% end %>
            </a>
            <% if current_user.role?(:system_administrator, nil) %>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="current-user-menu-link">
                <%= link_to t('navigation.create_seminar'), new_kommunity_path, class: "dropdown-item" %>
                <%= link_to t('navigation.manage_users'), admin_users_path, class: "dropdown-item" %>
                <%= link_to t('navigation.sign_out'), destroy_user_session_path, method: :delete, class: "dropdown-item" %>
              </div>
            <% elsif current_user.role?(:member, nil) %>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="current-user-menu-link">
                <%= link_to t('navigation.edit_profile'), edit_user_registration_path, class: "dropdown-item" %>
                <%= link_to t('navigation.sign_out'), destroy_user_session_path, method: :delete, class: "dropdown-item" %>
              </div>
            <% else %>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="current-user-menu-link">
                <%= link_to t('navigation.edit_profile'), edit_user_registration_path, class: "dropdown-item" %>
                <%= link_to t('navigation.sign_out'), destroy_user_session_path, method: :delete, class: "dropdown-item" %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="mb-0">
            <%= link_to t('navigation.sign_in_or_register'), new_user_session_path, class: "btn btn-primary" %>
          </p>
        <% end %>
      </div>
    </div>
  </nav>
  <div id="body-main-container" class="container-fluid">
    <main class="">
      <% if flash[:alert] %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <%= flash[:alert] %>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      <% end %>
      <%= yield %>
    </main>
    <div class="modal fade" id="submission-success-modal" tabindex="-1" role="dialog" aria-labelledby="submission-success-modal-title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="mt-3 text-center">
            <h5 id="submission-success-modal-title"><%= t('modals.thank_you') %></h5>
          </div>
          <div class="modal-body d-flex flex-column justify-content-center">
            <p class="text-center">
              <i class="fas fa-check-circle fa-5x text-success"></i>
            </p>
            <p class="text-center"><%= t('modals.response_saved') %></p>
            <a class="btn btn-primary" href="/">
              Ir al inicio
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="force-sign-in-modal" tabindex="-1" role="dialog" aria-labelledby="force-sign-in-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="mt-3 text-center">
          <h5 id="force-sign-in-modal-title"><%= t('modals.welcome_sign_in') %></h5>
        </div>
        <div class="modal-body d-flex justify-content-center">
          <%= link_to t('navigation.sign_in_or_register'), new_user_session_path, class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  </div>
  <%= yield :page_scripts %>
  <footer class="mt-5 footer bg-white shadow">
    <div class="text-center ">
      <p class="mb-0 text-muted">Hecho a rega√±adientes en <strong>Alquimia Digital</strong></p>
    </div>
  </footer>
</body>
</html>
